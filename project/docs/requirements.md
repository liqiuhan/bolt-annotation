# ChatBI 标注工具详细需求文档

## 项目背景
ChatBI 是一个智能化的业务查询工具，通过自然语言理解用户的查询意图，并转化为标准的业务查询。为了提高系统的智能化水平，需要对系统的理解结果进行人工标注和验证。本工具旨在提供一个直观、高效的标注界面，帮助标注人员对系统的理解结果进行验证和纠正。

## 功能模块详细说明

### 1. 上下文整合标注
#### 功能描述
- 展示用户的查询上下文，包括历史查询和当前查询
- 展示系统基于上下文整合后的查询结果
- 提供标注界面验证整合结果的准确性

#### 界面要求
- 使用不同的背景色区分历史查询（蓝色背景）和当前查询（紫色背景）
- 系统整合结果使用绿色背景突出显示
- 标注选项采用单选框形式，包括：
  - A：整合正确
  - B：不要整合
  - C：应该整合成其他内容
- 当选择"C"选项时，展开文本框用于输入正确的整合内容

#### 交互说明
- 选项切换时实时更新界面状态
- 选择"C"选项时自动聚焦到文本输入框
- 只有完成标注才能进入下一步

### 2. 查询拆解标注
#### 功能描述
- 展示系统对多指标查询的拆解结果
- 验证拆解是否准确完整
- 支持提供正确的拆解方式

#### 界面要求
- 原始查询使用蓝色背景突出显示
- 系统拆解结果使用绿色背景，并带有序号标识
- 标注选项采用单选框形式：
  - A：拆解正确
  - B：拆解不正确
- 选择"B"时显示自定义拆解界面

#### 交互说明
- 自定义拆解支持动态添加和删除
- 每个拆解项提供删除按钮
- 添加按钮位于拆解列表底部
- 至少需要一个拆解结果才能继续

### 3. 槽位提取和消歧标注
#### 功能描述
对每个拆解后的查询进行详细的槽位标注，包括指标、时间范围、约束条件等多个维度。

#### 界面布局
- 左侧固定步骤导航栏
  - 显示所有槽位类型
  - 使用图标指示完成状态
  - 点击可快速定位
- 右侧为标注区域
  - 每个槽位独立卡片展示
  - 卡片包含原始提取信息和消歧结果

#### 槽位类型详细说明

##### 3.1 指标槽位
- 搜索框功能：
  - 支持ID和名称搜索
  - 实时显示搜索结果
  - 结果格式：【ID：指标名称】
- 选中效果：
  - 自动填充到结果区域
  - 使用蓝色背景突出显示
- 支持查看指标的中间处理结果

##### 3.2 时间范围槽位
- 日期选择器要求：
  - 支持选择起止时间
  - 显示日历界面
  - 自动限制结束时间不早于开始时间
- 时间显示格式：YYYY-MM-DD
- 选择后自动生成标准格式的时间范围描述

##### 3.3 约束条件槽位
- 三列布局：
  1. 维度选择（下拉列表）
  2. 操作符选择（包含/不包含）
  3. 值范围输入框
- 支持多个约束条件
- 每个条件组合可独立删除
- 自动拼接生成标准格式的约束条件

##### 3.4 分组条件槽位
- 单列维度选择器
- 支持多个分组维度
- 每个维度可独立删除
- 自动生成分组描述文本

##### 3.5 排序条件槽位
- 三个组件组合：
  1. 排序方向选择（升序/降序）
  2. 排序类型选择（Top/Bottom）
  3. 数值输入框
- 实时预览排序描述

##### 3.6 计算方式槽位
- 简单复选框设计
- 选项：是否需要合计
- 直观的开关效果

#### 通用交互功能
1. 消歧结果显示控制
   - 页面顶部提供折叠/展开按钮
   - 折叠时隐藏所有消歧结果
   - 展开时恢复显示

2. 标注同步功能
   - 除指标外的槽位提供同步按钮
   - 点击后自动同步第一个查询的标注结果
   - 同步后可继续修改

3. 进度保存
   - 自动保存已标注内容
   - 支持随时回退修改
   - 提供清晰的完成度提示

## 交互流程
1. 进入标注
   - 展示欢迎信息
   - 显示标注任务说明

2. 标注过程
   - 清晰的步骤引导
   - 实时保存标注结果
   - 提供返回修改功能

3. 完成标注
   - 显示成功提示
   - 展示获得的积分
   - 提供继续标注选项

## 视觉设计要求
1. 配色方案
   - 主色调：蓝色系
   - 强调色：绿色（成功）、红色（错误）
   - 中性色：灰度层次

2. 布局原则
   - 清晰的视觉层次
   - 合理的空间分配
   - 一致的间距规范

3. 交互反馈
   - 即时的状态反馈
   - 清晰的操作提示
   - 平滑的动画过渡

## 性能要求
1. 响应速度
   - 界面切换流畅
   - 操作响应及时
   - 避免卡顿现象

2. 资源占用
   - 优化内存使用
   - 控制CPU占用
   - 减少不必要的重渲染

## 注意事项
1. 用户体验
   - 操作流程简单直观
   - 提供必要的使用提示
   - 支持快捷键操作

2. 异常处理
   - 输入验证和提示
   - 异常状态恢复
   - 数据自动保存

3. 浏览器兼容
   - 支持主流浏览器
   - 响应式布局适配
   - 确保核心功能可用